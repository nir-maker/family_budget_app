<!DOCTYPE html>
<html lang="he">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ניהול תקציב משפחתי</title>
  <!-- Tailwind CSS CDN -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.2.7/dist/tailwind.min.css" rel="stylesheet" />
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- React and ReactDOM -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <!-- React-Chartjs-2 (depends on React) -->
  <script src="https://cdn.jsdelivr.net/npm/react-chartjs-2@5.3.1/dist/react-chartjs-2.umd.min.js"></script>
  <!-- Babel for in-browser transpilation -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>

<body class="bg-gray-100">
  <div id="root" class="m-4"></div>

  <!-- Our React Code -->
  <script type="text/babel">
    const { useState, useEffect } = React;
    const { Line } = window['react-chartjs-2'];
    const { Chart: ChartJS, CategoryScale, LinearScale, PointElement, LineElement, Title, Tooltip, Legend, Filler } = window['chart.js'];

    ChartJS.register(CategoryScale, LinearScale, PointElement, LineElement, Title, Tooltip, Legend, Filler);

    function BudgetApp() {
      const [transactions, setTransactions] = useState(() => {
        const savedTransactions = localStorage.getItem("transactions");
        return savedTransactions ? JSON.parse(savedTransactions) : [];
      });
      const [amount, setAmount] = useState("");
      const [description, setDescription] = useState("");
      const [type, setType] = useState("income");
      const [balanceLimit, setBalanceLimit] = useState(-500);

      useEffect(() => {
        localStorage.setItem("transactions", JSON.stringify(transactions));
      }, [transactions]);

      const totalBalance = transactions.reduce((acc, t) => acc + t.amount, 0);

      useEffect(() => {
        if (totalBalance < balanceLimit) {
          sendAlert();
        }
      }, [totalBalance]);

      const sendAlert = () => {
        alert("אזהרה! אתם בחריגה מהתקציב!");
      };

      const addTransaction = () => {
        if (!amount || !description) return;
        const newTransaction = {
          id: Date.now(),
          description,
          amount: type === "income" ? parseFloat(amount) : -parseFloat(amount),
          date: new Date().toISOString().slice(0, 7),
        };
        setTransactions([...transactions, newTransaction]);
        setAmount("");
        setDescription("");
      };

      const chartData = {
        labels: transactions.map((_, index) => `תנועה ${index + 1}`),
        datasets: [
          {
            label: "יתרה",
            data: transactions.reduce((acc, t) => {
              acc.push((acc[acc.length - 1] || 0) + t.amount);
              return acc;
            }, []),
            borderColor: "#2563eb",
            backgroundColor: "rgba(37, 99, 235, 0.2)",
            fill: true,
          },
        ],
      };

      return (
        <div className="max-w-lg mx-auto mt-10 p-4 bg-gray-100 rounded-lg shadow-md md:max-w-2xl">
          <h1 className="text-2xl font-bold text-center mb-4 text-blue-600">ניהול תקציב משפחתי</h1>
          <div className="p-4 mb-4 bg-white rounded-lg shadow">
            <h2 className="text-lg font-semibold text-gray-700">יתרה נוכחית: {totalBalance.toFixed(2)} ₪</h2>
          </div>
          <div className="p-4 mb-4 bg-white rounded-lg shadow">
            <h2 className="text-lg font-semibold mb-2 text-gray-700">גרף יתרה</h2>
            <div className="h-64 w-full">
              <Line data={chartData} options={{ responsive: true, maintainAspectRatio: false }} />
            </div>
          </div>
          <div className="p-4 bg-white rounded-lg shadow">
            <h2 className="text-lg font-semibold mb-2 text-gray-700">הוספת תנועה</h2>
            <div className="flex flex-col gap-2 md:flex-row">
              <input
                type="number"
                placeholder="סכום"
                value={amount}
                onChange={(e) => setAmount(e.target.value)}
                className="p-2 border rounded"
              />
              <input
                type="text"
                placeholder="תיאור"
                value={description}
                onChange={(e) => setDescription(e.target.value)}
                className="p-2 border rounded"
              />
              <select
                value={type}
                onChange={(e) => setType(e.target.value)}
                className="p-2 border rounded"
              >
                <option value="income">הכנסה</option>
                <option value="expense">הוצאה</option>
              </select>
              <button
                onClick={addTransaction}
                className="bg-blue-500 text-white rounded p-2"
              >
                הוסף
              </button>
            </div>
          </div>
        </div>
      );
    }

    ReactDOM.render(<BudgetApp />, document.getElementById('root'));
  </script>
</body>
</html>
